# Pykod Configuration Generator

This Python script automatically generates pykod configuration files by inspecting the current running system. It creates a complete configuration that can be used to replicate your system setup.

## Features

The configuration generator inspects and captures:

- **Hardware Configuration**: Disk layout, partitions, and filesystem types
- **Boot Configuration**: Kernel and bootloader settings
- **System Locale**: Language, keymap, and timezone settings
- **Network Configuration**: Hostname and basic network settings
- **Repository Configuration**: Auto-detects Arch mirror and AUR helper (yay, paru, etc.)
- **Desktop Environments**: Automatically detects GNOME, KDE, Cosmic, Pantheon, and other DEs
- **Font Packages**: All installed font packages
- **User Configuration**: User accounts, groups, SSH keys, and dotfiles
- **Package Management**: All packages from Arch repositories, AUR, and Flatpak
- **System Services**: Enabled systemd services and their configurations

## Requirements

- Python 3.6+
- Arch Linux (or Arch-based distribution)
- Access to system commands: `lsblk`, `pacman`, `localectl`, `systemctl`, etc.

## Usage

### Basic Usage

Generate a configuration file for your current system:

```bash
python3 pykod_config_generator.py
```

This creates `auto_generated_config.py` in the current directory.

### Custom Output File

Specify a custom output filename:

```bash
python3 pykod_config_generator.py -o my_system_config.py
```

### Dry Run Mode

Preview the generated configuration without writing to file:

```bash
python3 pykod_config_generator.py --dry-run
```

### Help

Get help on all available options:

```bash
python3 pykod_config_generator.py --help
```

## Generated Configuration Structure

The generated configuration file follows the standard pykod format and includes:

1. **Header**: Metadata about the generation process
2. **Repository Setup**: Arch, AUR, and Flatpak repositories
3. **Hardware Configuration**: Disks and partitions
4. **Boot Configuration**: Kernel and bootloader
5. **Locale Settings**: Language, timezone, keymap
6. **Network Settings**: Hostname and network configuration
7. **Desktop Environments**: Detected desktop environments and packages
8. **Font Configuration**: All installed font packages
9. **User Configuration**: User accounts, SSH keys, programs, and services
10. **Package List**: Complete list of installed packages
11. **System Services**: Enabled services and their configurations

## Example Generated Configuration

```python
#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# Pykod configuration for hostname
# ------------------------------------------------------------
# Description: Auto-generated pykod configuration representing the current system state.
# Generated by: Pykod Configuration Generator
# Date: 2026-01-13 00:00:00
# Host: hostname
# License: MIT
# ------------------------------------------------------------

# Import necessary modules from pykod
from pykod import *
from pykod.repositories import AUR, Arch, Flatpak

archpkgs = Arch(mirror_url="https://geo.mirror.pkgbuild.com")  # Auto-detected mirror
aurpkgs = AUR(helper="yay", helper_url="https://aur.archlinux.org/yay.git")  # Auto-detected helper
flatpakpkgs = Flatpak(hub_url="flathub")

conf = Configuration(base=archpkgs, dry_run=True, debug=True, verbose=True)

# ... rest of configuration
```

## System Detection Details

### Hardware Detection

- Uses `lsblk -f -J` to get disk and partition information
- Automatically detects partition types (ESP, swap, root, etc.)
- Maps mount points to partition configurations

### Repository Detection

- **Arch Mirror**: Reads `/etc/pacman.d/mirrorlist` to detect the active mirror
- **AUR Helper**: Automatically detects installed AUR helpers:
  - Supports: paru, yay, pikaur, trizen, pakku, aura, pamac
  - Uses `which` command and package detection
  - Falls back to paru if none detected

### Package Detection

- **Arch packages**: Uses `pacman -Qqe` to get explicitly installed packages
- **AUR packages**: Uses `pacman -Qqm` to get foreign (typically AUR) packages  
- **Flatpak packages**: Uses `flatpak list --app` to get installed applications

### Service Detection

- Uses `systemctl list-unit-files --state=enabled` to find enabled services
- Maps common services to their package requirements
- Includes service-specific configuration where applicable

### User Detection

- Reads user information from system passwd database
- Detects user groups and sudo permissions
- Searches for SSH public keys in `~/.ssh/`
- Identifies common development tools and editors

### Desktop Environment Detection

- Scans installed packages for desktop environment indicators
- Detects GNOME, KDE, Cosmic, Pantheon, XFCE, Cinnamon, Budgie, and Hyprland
- Includes desktop-specific packages and extensions

## Troubleshooting

### Permission Issues

Some commands may require elevated permissions. Run with sudo if needed:

```bash
sudo python3 pykod_config_generator.py
```

### Missing Dependencies

Ensure all required system tools are available:

- `lsblk` - for disk information
- `pacman` - for package information  
- `localectl` - for locale information
- `systemctl` - for service information
- `flatpak` - for Flatpak package information (if used)

### Incomplete Detection

If some aspects of your system aren't detected:

1. Check that the relevant packages are actually installed
2. Verify that services are properly enabled with systemctl
3. Ensure the script has access to read system configuration files

## Customization

The generated configuration serves as a starting point. You may want to:

1. Review and adjust partition sizes
2. Modify package lists to remove unwanted software
3. Adjust service configurations
4. Add custom mount points or network settings
5. Update user passwords and SSH key configurations

## Contributing

The configuration generator is designed to be extensible. Key areas for enhancement:

- Support for additional desktop environments
- Better detection of custom configurations
- Support for non-Arch distributions
- Enhanced error handling and logging

## License

MIT License - Feel free to modify and distribute as needed.